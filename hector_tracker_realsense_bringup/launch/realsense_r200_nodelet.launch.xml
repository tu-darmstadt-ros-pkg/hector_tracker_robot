<launch>
<!-- rgbd_launch -->
    <!-- Name of nodelet manager, must be fully resolved -->
    <arg name="manager" />
    <arg name="camera"              default="camera" />
    <arg name="publish_tf"          default="true" />
    <arg name="depth"               default="depth" />
    <arg name="rgb"                 default="rgb" />
    <arg name="ir"                  default="ir" />
    <arg name="depth_processing"    default="" />
    <arg name="rgb_processing"      default="" />
    <arg name="ir_processing"       default="" />
<!-- rgbd_launch -->

<!-- RealSense -->
    <arg name="serial_no"           default="" />
    <arg name="usb_port_id"         default="" />
    <arg name="mode"                default="" />
    <arg name="color_width"         default="" />
    <arg name="color_height"        default="" />
    <arg name="depth_width"         default="" />
    <arg name="depth_height"        default="" />
    <arg name="depth_fps"           default="" />
    <arg name="color_fps"           default="" />
    <arg name="ir2"                 default="ir2" />
    
    <arg name="respawn" default="false" />
    <arg     if="$(arg respawn)" name="bond" value="" />
    <arg unless="$(arg respawn)" name="bond" value="--no-bond" />

    <!-- "enable_depth_ir" will take the value of "enable_ir" only if "enable_ir" is true.
         Else "enable_depth_ir" will take the value of "enable_depth" -->
    <arg name="enable_depth_ir"     value="$(arg ir_processing)"    if="$(arg ir_processing)" />
    <arg name="enable_depth_ir"     value="$(arg depth_processing)" unless="$(arg depth_processing)" />

     <!-- "enable_pointcloud" is set to false by default because rgbd launch uses standard ROS packages
          to generate point clouds. -->
    <arg name="enable_pointcloud"   default="true" />
<!-- RealSense -->

    <node pkg="nodelet" type="nodelet" name="camera_nodelet"
        args="load realsense_camera/R200Nodelet $(arg manager) $(arg bond)"
        respawn="$(arg respawn)"  >
        <param name="serial_no"               type="str"  value="$(arg serial_no)" />
        <param name="usb_port_id"             type="str"  value="$(arg usb_port_id)" />
        <param name="mode"                    type="str"  value="$(arg mode)" />
        <param name="enable_depth"            type="bool" value="$(arg enable_depth_ir)" />
        <param name="enable_color"            type="bool" value="$(arg rgb_processing)" />
        <param name="enable_pointcloud"       type="bool" value="$(arg enable_pointcloud)" />
        <param name="enable_tf"               type="bool" value="$(arg publish_tf)" />
        <param name="depth_width"             type="int"  value="$(arg depth_width)" />
        <param name="depth_height"            type="int"  value="$(arg depth_height)" />
        <param name="color_width"             type="int"  value="$(arg color_width)" />
        <param name="color_height"            type="int"  value="$(arg color_height)" />
        <param name="depth_fps"               type="int"  value="$(arg depth_fps)" />
        <param name="color_fps"               type="int"  value="$(arg color_fps)" />
        <param name="base_frame_id"           type="str"  value="$(arg camera)_link" />
        <param name="depth_frame_id"          type="str"  value="$(arg camera)_$(arg depth)_frame" />
        <param name="color_frame_id"          type="str"  value="$(arg camera)_$(arg rgb)_frame" />
        <param name="depth_optical_frame_id"  type="str"  value="$(arg camera)_$(arg depth)_optical_frame" />
        <param name="color_optical_frame_id"  type="str"  value="$(arg camera)_$(arg rgb)_optical_frame" />
        <param name="ir_frame_id"             type="str"  value="$(arg camera)_$(arg ir)_frame" />
        <param name="ir2_frame_id"            type="str"  value="$(arg camera)_$(arg ir2)_frame" />

        <remap from="depth"        to="$(arg depth)" />
        <remap from="color"        to="$(arg rgb)" />
        <remap from="infrared1"    to="$(arg ir)" />
        <remap from="infrared2"    to="$(arg ir2)" />
        
        <!-- The following two tags map the correctly aligned depth from zhang-xin's fork
             (https://github.com/zhang-xin/realsense/commit/926fe72d215ef29fa8f9409ebc234250d396e8e7)
             to where the topics used to be when using the standard intel/ros configuration,
             so no further modification to the subscribing nodes are necessary.
        -->
        <remap from="depth_aligned"        to="/arm_rgbd_cam/depth_registered/sw_registered" />
        <remap from="/arm_rgbd_cam/depth_registered/sw_registered/image_raw" to="/arm_rgbd_cam/depth_registered/sw_registered/image_rect_raw" />

    </node>
</launch>
